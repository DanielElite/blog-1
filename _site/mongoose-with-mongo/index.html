<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="author" content="lamour" />
		<title>Mongooser Should Know ?</title>
		<link rel="shortcut icon" href="/favicon.ico" />
		<link href="/feed/" rel="alternate" title="lamour" type="application/atom+xml" />
		<link rel="stylesheet" href="/media/css/style.css" />
		<link rel="stylesheet" href="/media/css/highlight.css" />
		<script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
	</head>
	<body>
		<div id="container">
			<div id="main" role="main">
				<header>
				<h1>Mongooser Should Know ?</h1>
				</header>
				<nav>
				<span><a title="网站首页" class="" href="/">首页</a></span>
				<span><a title="文章分类" class="" href="/categories/">分类</a></span>
				<span><a title="标签索引" class="" href="/tags/">标签</a></span>
				<!--<span><a title="友情链接" class="" href="/links/">链接</a></span>-->
				<span><a title="留言交流" class="" href="/guestbook/">留言</a></span>
                                <!--<span><a title="订阅本站" class="" href="/feed.xml">订阅</a></span>-->
				<span><a title="关于站长" class="" href="/about/">关于</a></span>
				</nav>
				<article class="content">
				<section class="meta">
<span class="time">
  <time datetime="2016-09-30">2016-09-30</time>
</span>

 | 
<span class="categories">
  分类
  
  <a href="/categories/#全栈工程师" title="全栈工程师">全栈工程师</a>&nbsp;
  
</span>


 | 
<span class="tags">
  标签
  
  <a href="/tags/#学习笔记" title="学习笔记">学习笔记</a>&nbsp;
  
</span>

</section>
<section class="post">
<h3 id="before">Before</h3>

<p>```js
var mongoose = require(‘mongoose’);
mongoose.connect(‘mongodb://localhost/test’);</p>

<p>var Cat = mongoose.model(‘Cat’, { name: String });</p>

<p>var kitty = new Cat({ name: ‘Zildjian’ });
kitty.save(function (err) {
  if (err) {
    console.log(err);
  } else {
    console.log(‘meow’);
  }
});</p>

<p>```</p>

<p>You can see the above code in mongoosejs.com. And you should know, There is not only way to connect the mongo server.</p>

<table>
  <thead>
    <tr>
      <th>Mongoose</th>
      <th style="text-align: center">Mongo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Schema</td>
      <td style="text-align: center">Document Schema</td>
    </tr>
    <tr>
      <td>Model</td>
      <td style="text-align: center">Collection</td>
    </tr>
  </tbody>
</table>

<p>```js
var mongoose = require(‘mongoose’);
mongoose.connect(‘mongodb://localhost/test’);
var animalSchema = mongoose.Schema({ name: String });
var Cat = mongoose.model(‘Cat’,animalSchema );</p>

<p>var kitty = new Cat({ name: ‘Zildjian’ });
kitty.save(function (err) {
  if (err) {
    console.log(err);
  } else {
    console.log(‘meow’);
  }
});</p>

<p>```</p>

<p>Also, you have different ways to define your function, In Schema, or In the instance of model</p>

<h3 id="in-my-pratice-there-is-some-problems">In my pratice, There is some problems</h3>

<ul>
  <li>findOneAndUpdata(condition,updata,function(err, data){})</li>
</ul>

<blockquote>

  <p>If i find the data , i will return the finded data, and Updata, So, you  can’t through the data to judge which field was changed.</p>
</blockquote>

<ul>
  <li>when you use the method of updata(condition, udpata), what happend?</li>
</ul>

<blockquote>

  <p>first of all, it will be find the condition and if the conidition is existed, it would be updata, and return a Data, if not , also return a data. Like: <code class="highlighter-rouge"><span class="p">{</span><span class="err">ok:1,nModified:0,n:0</span><span class="p">}</span></code>, as you see, if you find, ok will be set 1, if you find and updata, the number of your updata is nModified, and n is matched number.But in mongo shell, it will return <code class="highlighter-rouge"><span class="p">{</span><span class="err">nMathced:5,nUpserted:0,nModified:3</span><span class="p">}</span></code>, So there also a problem, no matter what the number of filed was changed, it only dispaly <code class="highlighter-rouge"><span class="p">{</span><span class="err">ok:1,nModified:0,n:1</span><span class="p">}</span></code>. So , i still don’t know the number of filed.</p>
</blockquote>

<ul>
  <li>find ObjectId,  __id</li>
</ul>

<blockquote>

  <p>var ObjectId = require(‘mongoose’).Types.ObjectId;
when you use the find method , just like this: find({_id:ObjectId(youridvalue)})</p>
</blockquote>

<ul>
  <li>you can use insert in mongo shell , but not mongoose. you should use create to create a new document.</li>
  <li>save not only save, it contained updata, it the document was not found , it will be created, if not, it will update it.</li>
</ul>

<font color="red">注意异步，异步，异步。你在操作数据库的时候，如果你需要遍历，那么你这边遍历完了，那边可能还没有返回数据。所以，当返回的时候，res.json()的那个数据只是最后一次查询得到的数据，一定要设置flag去判断是不是全部查询并且可以返回了 </font>

<h4 id="other">Other</h4>
<p>前几天同学要买乐视手机，让我也帮忙抢。等从他发给我的界面找到真实界面，花了一个多小时写了下面这个脚本，测试也测试了，然而还是没抢到。如果不是网速的原因，那我只能怀疑的是乐视在骗人，fuck。
吐槽: 抢购页面，点击立即秒杀，然后再跳到真正的购物页面，然后还他妈要点立即抢购，乐视好心机，每天的抢购页面的URL编号是固定规律改变的。像我这种找到正确秒杀页面，然后又提前两分钟放脚本等着的
都没有抢到，这活动的真实性不可靠。　最心酸的是，打开淘宝，发现官网的抢购价还没有淘宝的便宜。。。。。</p>

<p>```js</p>

<p>var Wait = $(“.not_start”);
var MiaoSha = $(“.rush_now”);</p>

<p>count = 0;
var IntervalTime = setInterval(
function(){
	var Time   = $(“#timer&gt;span”).text();
	if(Wait.length != 2){
		if (Time ==”00000000”  || Wait.style.display != “block” || MiaoSha.style.display != “none” ){
				MiaoSha.click();
				clearInterval(IntervalTime);
			}else{
				count ++;
				console.log(“已抢：” + count + “次”);
			}
		}else{</p>

<div class="highlighter-rouge"><pre class="highlight"><code>			if (Time =="00000000" || Wait[0].style.display != "block" || MiaoSha[0].style.display != "none" ){
			MiaoSha.click();
			clearInterval(IntervalTime);

		}else{
			count ++;
			console.log("已抢：" + count + "次");
		}

	}

},10 )
</code></pre>
</div>

<p>```</p>

<h4 id="resources">Resources</h4>

<ul>
  <li><a href="http://mongoosejs.com/">MongooseJs</a></li>
</ul>

</section>
<section align="right">
<br/>
<span>
	<a  href="/Js-Open-camera/" class="pageNav"  >上一篇</a>
	&nbsp;&nbsp;&nbsp;
	<a  href="/Jmeter-PostMan/" class="pageNav"  >下一篇</a>
</span>
</section>

	
	<div class="ds-thread" />
		
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"lamour"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>


				</article>
			</div>

			<footer>
			<p><small>
				<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/cn/" target="_blank" title="许可协议">©</a> 2014 - 2016 <a href="/about/">lamour</a>
			</small></p>
			</footer>

		</div>
	</body>
</html>
